---
title:  "실습_3장_API를 이용한 크롤링"
toc: true
toc_sticky: true
categories:
  - Web
  - Crawling
tags:

last_modified_at: 2020-07-31
---
# Daum 증권 페이지에서 주가 크롤링

* 다음과 같은 방법으로 API url을 찾는다
![api_network](/assets/images/ai/api_network.png)  

```python 
import requests
import json

custom_header = {
    'referer' : 'http://http://finance.daum.net/quotes/A048410#home',
    'user-agent' : 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.103 Safari/537.36'  }

def get_data() :
    result = []
    url = "http://finance.daum.net/api/search/ranks?limit=10" 
    # 상위 10개 기업의 정보를 얻는 API url을 작성
    req = requests.get(url, headers = custom_header)
    
    if req.status_code == requests.codes.ok:    
        print("접속 성공")
        # API에 접속에 성공하였을 때의 logic을 작성
        # JSON 데이터의 원하는 부분만 불러와 result에 저장
        
        # ========================================================
        stock_data = json.loads(req.text)
        # stock_data에 json파일을 json.loads해서 담아준다
        # ========================================================
        for i in stock_data['data']:
            
            print(i)
            result.append([i['rank'], i['name'], i['tradePrice']])
    else:
        print("접속 실패")
    
    return result

def main() :
    data = get_data()
    
    for d in data :
        print(d)
    
if __name__ == "__main__" :
    main()
```
